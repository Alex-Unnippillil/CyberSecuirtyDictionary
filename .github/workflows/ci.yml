name: CI

on:
  push:
  pull_request:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install linters
        run: npm install --no-save eslint@8 stylelint cspell
      - name: ESLint
        run: npx eslint@8 --no-eslintrc --env browser --env es2021 script.js
      - name: stylelint
        run: npx stylelint styles.css
      - name: cSpell
        run: npx cspell README.md terms.json
      - name: Link checker
        uses: lycheeverse/lychee-action@v2
        with:
          args: --no-cache terms.json
      - name: Install Python dependencies
        run: pip install textstat
      - name: Readability
        run: python scripts/readability.py > grade-report.txt
      - name: Comment readability
        if: ${{ github.event_name == 'pull_request' }}
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const report = fs.readFileSync('grade-report.txt', 'utf8');
            const match = report.match(/Average grade level: ([0-9.]+)/);
            const avg = match ? match[1] : 'N/A';
            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: [
                'ðŸ“˜ **Readability Report**',
                '',
                `Average grade level: ${avg}`,
                '',
                '```',
                report,
                '```'
              ].join('\n')
            });
